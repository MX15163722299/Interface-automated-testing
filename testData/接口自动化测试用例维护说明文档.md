# 接口自动化测试用例维护说明文档

## 一、测试数据来源

测试数据文件：`data.xls` / `data_01.xlsx`
 存放路径：`/testData/`
 用途：驱动自动化测试的核心用例数据，每一行即代表一条用例。

------

## 二、字段说明（每列含义）

| 字段名         | 含义               | 必填 | 说明                                    |
| -------------- | ------------------ | ---- | --------------------------------------- |
| `id`           | 用例唯一编号       | ✅    | 整型或浮点型。用于标识和依赖引用。      |
| `title`        | 用例描述           | ✅    | 用于报告输出                            |
| `interfaceUrl` | 请求地址           | ✅    | 全路径，如：http://localhost:5000/login |
| `method`       | 请求方式           | ✅    | `get`, `post`, `put`, `delete` 等       |
| `contentType`  | 请求内容类型       | ✅    | 如：`json`, `form`, `params`, `none`    |
| `value`        | 请求体参数         | ✅    | JSON字符串或原始文本。支持依赖替换。    |
| `header`       | 请求头参数         | ⬜    | JSON字符串。支持依赖替换。              |
| `rely`         | 是否有依赖         | ✅    | `y` 表示此用例依赖其他接口返回的数据    |
| `expect`       | 预期结果           | ✅    | JSON字符串，用于断言结果                |
| `extract`      | 提取参数           | ⬜    | 可用于后续增强提取逻辑                  |
| `name`         | 接口名（唯一标识） | ✅    | 便于调试时输出日志追踪                  |



------

## 三、依赖关系写法规范（超关键）

### 1. 占位符语法

统一使用：`${case_id:field}`，支持以下形式：

| 格式                 | 说明                                            |
| -------------------- | ----------------------------------------------- |
| `${2:token}`         | 表示从 ID=2 的接口返回 JSON 中提取 `token` 字段 |
| `${2:user.info.id}`  | 支持多级路径提取                                |
| `${2:items[0].name}` | 支持列表索引提取                                |
| `${2:Set-Cookie}`    | 表示从 ID=2 的接口响应头中提取字段              |



### 2. 示例

```
json复制编辑"value": "{'username': '${2:username}', 'info': {'age': '${2:info.age}'}}"
"header": "{'Cookie': '${2:Set-Cookie}'}"
```

依赖的是编号为 `2` 的接口，执行后从其响应中提取相应值填充进当前请求中。

------

## 四、用例依赖机制说明（源码支持）

当前已支持：

✅ 多接口依赖同时存在
 ✅ 嵌套字段提取（支持多级、数组）
 ✅ header + body 替换
 ✅ 自定义 Set-Cookie 抽取规则（默认 `;` 截断取第一段）

> 所有依赖接口在执行当前用例前自动运行一次，并将其响应结果缓存到 `res_dict` 中，无需手动执行依赖。

------

## 五、如何新增/维护用例

1. 打开 `data.xls` 或 `data_01.xlsx`
2. 每新增一行即是一条用例，注意填写 `id` 字段为唯一编号
3. 若该用例依赖其他接口响应数据，需：
   - 在 `value` 或 `header` 中写 `${x:field}` 占位符
   - 并将 `rely` 字段设置为 `y`

------

## 六、错误排查指引

| 日志信息                   | 原因                                                         |
| -------------------------- | ------------------------------------------------------------ |
| `❌ 未找到依赖的用例 ID=2`  | 说明数据中没有 ID=2 的用例                                   |
| `❌ 用例处理失败`           | 一般为 JSON 格式错误，请检查 `value` 或 `header` 是否是合法 JSON 字符串 |
| `⚠️ 匹配多个值，仅取第一个` | JSONPath 匹配到多个字段，系统默认只使用第一个，建议使用路径式 `${2:user.info.id}` 精确提取 |



------

## 七、推荐格式示例（粘贴用）

| id   | title        | interfaceUrl                | method | contentType | value                                       | header                          | rely | expect             | name     |
| ---- | ------------ | --------------------------- | ------ | ----------- | ------------------------------------------- | ------------------------------- | ---- | ------------------ | -------- |
| 2    | 登录         | http://localhost:5000/login | post   | form        | `{"username": "user1", "password": "p001"}` | `{}`                            | n    | `{"errorcode": 0}` | login    |
| 3    | 获取用户信息 | http://localhost:5000/info  | get    | params      | `{"uid": "${2:uid}"}`                       | `{"Cookie": "${2:Set-Cookie}"}` | y    | `{"errorcode": 0}` | get_info |



------

## 八、后续可拓展方向

- 支持提取并存储接口返回结果到变量池
- 支持断言增强（如断言类型、包含、长度等）
- 支持请求体文件上传字段、form-data、文件流等